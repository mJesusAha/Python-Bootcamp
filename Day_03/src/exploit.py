# EX01
# python3 exploit.py
def new_adress(n: str):
    str_adress = ""
    flag = 0

    for i in range(len(n)):
        if flag == 0 or flag == 2:
            str_adress = str_adress + n[i]
        if n[i] == '"':
            flag += 1
        if flag == 1 and n[i] == '"':
            str_adress = str_adress + 'https://mrrobot.fandom.com/wiki/Fsociety"'

    str_adress = str_adress.replace("Evil Corp", "Fsociety")
    return str_adress


def add_trenton():
    text = (
        "<script>\n\t\thacked = function() {\n\t\t\talert("
        + "'hacked');\n\t\t}\n\t\twindow.addEventListener('load', \n\t\t\tfunction()"+
        " { \n\t\t\t\tvar f = document.querySelector("
        + '"form");\n\t\t\tf.setAttribute("onsubmit", "hacked()");\n\t\t\t},\n\t\t\tfalse\n\t\t);\n</script>"'
    )
    return text


def change_name(n: str):
    flag = 0
    name_1 = ""
    name_2 = ""
    for i in range(len(n)):
        if flag == 3 and n[i] != "<":
            name_1 = name_1 + n[i]
        if n[i] == ">":
            flag += 1
        if n[i] == "<" and flag == 3:
            flag = 4
        if n[i] == ">" and flag == 4:
            flag = 5
        if n[i] == "<" and flag == 5:
            flag = 6
        if flag == 5 and n[i] != ">":
            name_2 = name_2 + n[i]

    new_str = "\t\t\t\t<h1>" + name_1 + name_2 + ", you are hacked!</h1>\n"

    return new_str


with open("../materials/evilcorp.html") as f:
    print(*f)  # прочитала файл
    f = open("../materials/evilcorp.html", "r+")
    n = f.readlines()
    new_text = "<title>Evil Corp - Stealing your money every day</title>"
    f = open("../materials/evilcorp_hacked.html", "w+")
    for i in range(len(n)):
        h1 = ""
        if n[i].count("title"):
            n[i] = new_text + "\n"
            line = i
        if n[i].count("pronoun"):
            name = n[i]
            h1 = change_name(n[i])
            text = h1
            f = open("../materials/evilcorp_hacked.html", "a")
            f.write(n[i])
            f.write(text)
            f.write(add_trenton())
            continue
        if n[i].count("http"):
            n[i] = new_adress(n[i])
        f = open("../materials/evilcorp_hacked.html", "a")
        f.write(n[i])
